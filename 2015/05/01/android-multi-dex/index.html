<!DOCTYPE html><html lang="Chinese"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 打破Android应用65K方法数魔咒 · 码农明明桑</title><meta name="description" content="打破Android应用65K方法数魔咒 - Sam"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.isming.me/atom.xml" title="码农明明桑"></head><body><div class="wrap"><header><a href="/" class="logo-link"><!--img(src=url_for(theme.logo) alt="logo")--><h1>码农明明桑</h1></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/links" target="_self" class="nav-list-link">FRIENDS</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">打破Android应用65K方法数魔咒</h1><div class="post-info">May 1, 2015</div><div class="post-content"><p>近日，我们的应用，在编译的时候不幸的遇到这个错误</p>
<blockquote>
<p>Conversion to Dalvik format failed: Unable to execute dex: method ID not in [0, 0xffff]: 65536</p>
</blockquote>
<p>这才让我意识到原来我们的程序中，方法数已经超过了65536。在之前，已经知道了android系统的java虚拟机dalvik在执行java程序时，使用原生类型short来索引dex文件中的方法，因此方法数就呗限制在65536了。之前我一直以为，这个数量已经很大了，不会达到上限，结果今天就达到了。</p>
<p>不过这个东西呢，我们也是很容易的进行解决的，因为，就在去年不久前，google官方提供了多dex的支持库，因此，我们可以很简单的解决这个问题。</p>
<a id="more"></a>
<h3 id="开发工具升级"><a href="#开发工具升级" class="headerlink" title="开发工具升级"></a>开发工具升级</h3><p>将android sdks build tools 和android support library要升级到最新的，这个使用android sdks manager很容易就完成了。</p>
<h3 id="配置build-gradle"><a href="#配置build-gradle" class="headerlink" title="配置build.gradle"></a>配置build.gradle</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">android &#123; </div><div class="line">compileSdkVersion 21 </div><div class="line">buildToolsVersion "21.1.0" </div><div class="line">defaultConfig &#123;     </div><div class="line">...     </div><div class="line">minSdkVersion 14     </div><div class="line">targetSdkVersion 21     </div><div class="line">...     </div><div class="line">// Enabling multidex support.     </div><div class="line">multiDexEnabled true </div><div class="line">&#125; </div><div class="line">... </div><div class="line">&#125; </div><div class="line">dependencies&#123; </div><div class="line">compile 'com.android.support:multidex:1.0.0’ //dependencies</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="让应用支持多dex"><a href="#让应用支持多dex" class="headerlink" title="让应用支持多dex"></a>让应用支持多dex</h3><p>androidManifest.xml中application中声明android.support.multidex.MultiDexApplication;</p>
<p>或自己定义一个Application类，继承自MultiDexApplication；</p>
<p>或者自己定义的Application类，在attachBaseContext()方法中，添加MultiDex.install(this);</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>通过上面的方法即可轻松完成多dex，不过在低版本的android系统（低于android4.0）可能会有bug出现，还要多进行测试。</p>
<p>究其原因，其实我们的app，自己写的代码现在其实不是很多，代码中使用了大量的第三方sdk，以及其他的一些功能集成。</p>
<p>下面，就要想办法，减少第三方的功能库了。这里跟大家分享一下解决方案。</p>
<p>参考资料： <a href="http://developer.android.com/tools/building/multidex.html" target="_blank" rel="external">http://developer.android.com/tools/building/multidex.html</a></p>
<blockquote>
<p>原文地址：<a href="http://blog.isming.me/2015/05/01/android-multi-dex/">http://blog.isming.me/2015/05/01/android-multi-dex/</a>，转载请注明出处。</p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/2015/05/10/sticker-view/" class="prev">上一篇</a><a href="/2015/03/18/android-build-speed-up/" class="next">下一篇</a></div><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script><script>var cloudTieConfig = {
    url: document.location.href,
    sourceId: "2015/05/01/android-multi-dex/",
    productKey: "a094f65b0cf3436d922737584f8a4bb2",
    target: "cloud-tie-wrapper"
};
var yunManualLoad = true;
Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);</script><div class="copyright"><p>© 2013 - 2017 <a href="http://blog.isming.me">Sam</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//hm.baidu.com/h.js?c22f102f5fbaa79cf43b93add1805f4f"></script></body></html>