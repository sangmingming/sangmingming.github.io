<!DOCTYPE html><html lang="Chinese"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 一个上传apk到fir的gradle插件 · 码农明明桑</title><meta name="description" content="一个上传apk到fir的gradle插件 - Sam"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.isming.me/atom.xml" title="码农明明桑"></head><body><div class="wrap"><header><a href="/" class="logo-link"><!--img(src=url_for(theme.logo) alt="logo")--><h1>码农明明桑</h1></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/links" target="_self" class="nav-list-link">FRIENDS</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">一个上传apk到fir的gradle插件</h1><div class="post-info">Aug 1, 2015</div><div class="post-content"><p>声明，这不是广告，没有任何利益瓜葛。</p>
<p>App内测需要把安装把安装包放在一个地方进行托管，方便内测人员下载。国内有蒲公英，fir，等等这些网站可以用。</p>
<p>最近fir上了新版本了，上了新的api，新界面，本以为它们会提供gradle的上传工具，结果没有，而且它们新版本还不好用，原本的下载统计浏览统计都没有了，结果上传很慢，甚至上传不了，我便写了一个gradle的上传工具。</p>
<a id="more"></a>
<p>先介绍使用方法吧</p>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>插件目前只有唯一一个task</p>
<blockquote>
<p>uploadFir  –上传apk到fir</p>
</blockquote>
<p>集成插件本插件，你要按照如下方法使用</p>
<h4 id="编辑build-gradle"><a href="#编辑build-gradle" class="headerlink" title="编辑build.gradle"></a>编辑build.gradle</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">  repositories &#123;</div><div class="line">    jcenter()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  dependencies &#123;</div><div class="line">        classpath <span class="string">'com.squareup.okhttp:okhttp:2.2.0'</span></div><div class="line">        classpath <span class="string">'com.squareup.okhttp:okhttp-urlconnection:2.2.0'</span></div><div class="line">        classpath <span class="string">'org.json:json:20090211'</span></div><div class="line">        classpath <span class="string">'me.isming:firup:0.4.1'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">apply <span class="string">plugin:</span> <span class="string">'me.isming.fir'</span></div><div class="line"></div><div class="line">fir &#123;</div><div class="line">    appId = <span class="string">""</span>   <span class="comment">//app的appid,在fir中可以找到</span></div><div class="line">    userToken = <span class="string">""</span>  <span class="comment">//fir用户的token，也在在fir中找到</span></div><div class="line"></div><div class="line">    apks &#123;</div><div class="line">        release &#123;</div><div class="line">            <span class="comment">// 要上传的apk的路径,类似下面</span></div><div class="line">            sourceFile  file(<span class="string">"/project/main/build/outputs/apk/xxx.apk"</span>)</div><div class="line">            name <span class="string">""</span>  <span class="comment">//app的名称</span></div><div class="line">            version <span class="string">"3.3.0"</span>  <span class="comment">//app的版本version</span></div><div class="line">            build <span class="string">"330"</span>   <span class="comment">//app的版本号</span></div><div class="line">            changelog <span class="string">""</span>  <span class="comment">//更新日志</span></div><div class="line">            icon file(<span class="string">"....../res/drawable-xxhdpi/icon_logo.png"</span>)  <span class="comment">//app的icon的路径</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>####运行</p>
<blockquote>
<p>$ ./gradlew uploadFir</p>
</blockquote>
<p>你也可以在本任务的基础上，在你的build脚本中增加以下内容:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">uploadFir.dependsOn assembleRelease  <span class="comment">//后面为你生成apk的任务</span></div></pre></td></tr></table></figure>
<p>这样就可以在执行上传到fir之前首先会生成一个最新的安装包了</p>
<p>本插件基于fir.im官方提供的api文档进行编写，时间匆忙，可能还有一些地方不够完善，还有许多地方可以优化，欢迎star，fork，共同完善。</p>
<p>也可以给我提意见，我来优化。</p>
<p>还有一些代优化的点没有做，后面有空会做，version，build，icon通过程序自动做，而不用手工填写。</p>
<p>项目托管在github上面，生成的jar放在jcenter上面。</p>
<p>github地址：<a href="https://github.com/sangmingming/gradle-fir-plugin" target="_blank" rel="external">https://github.com/sangmingming/gradle-fir-plugin</a></p>
<blockquote>
<p>原文地址：<a href="http://blog.isming.me/2015/08/01/gradle-fir-plugin/">http://blog.isming.me/2015/08/01/gradle-fir-plugin/</a>，转载请注明出处。</p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/2015/08/31/modify-alert-style/" class="prev">PREV</a><a href="/2015/07/07/android-custom-font/" class="next">NEXT</a></div><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script><script>var cloudTieConfig = {
    url: document.location.href,
    sourceId: "2015/08/01/gradle-fir-plugin/",
    productKey: "a094f65b0cf3436d922737584f8a4bb2",
    target: "cloud-tie-wrapper"
};
var yunManualLoad = true;
Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);</script><div class="copyright"><p>© 2013 - 2017 <a href="http://blog.isming.me">Sam</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//hm.baidu.com/h.js?c22f102f5fbaa79cf43b93add1805f4f"></script></body></html>