<!DOCTYPE html><html lang="Chinese"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 发布程序时移除Android 调试Log · 码农明明桑</title><meta name="description" content="发布程序时移除Android 调试Log - Sam"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.isming.me/atom.xml" title="码农明明桑"></head><body><div class="wrap"><header><a href="/" class="logo-link"><!--img(src=url_for(theme.logo) alt="logo")--><h1>码农明明桑</h1></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/links" target="_self" class="nav-list-link">FRIENDS</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">发布程序时移除Android 调试Log</h1><div class="post-info">Jun 30, 2014</div><div class="post-content"><p>在Android开发中，我们使用android.util.Log来打印日志，方便我们的开发调试。但是对于正式发布的程序，我们并不希望这些Log信息显示，一方面对于用户来说影响机器性能，另一方面，其他开发者看到这些信息的时候，对我们应用程序的安全是有威胁的。所以，我们需要在正式发布时不让Log执行，或者将其移除。这里，我提供三种方法。</p>
<h3 id="自己写一个Log的帮助类，在类中设置显示级别"><a href="#自己写一个Log的帮助类，在类中设置显示级别" class="headerlink" title="自己写一个Log的帮助类，在类中设置显示级别"></a>自己写一个Log的帮助类，在类中设置显示级别</h3><p>示例代码如下，通过一个静态变量设置Log的显示级别。<br><a id="more"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Log</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> logLevel = Log.VERBOSE;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">i</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (logLevel &lt;= Log.INFO)</div><div class="line">          android.util.Log.i(tag, msg);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">e</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (logLevel &lt;= Log.ERROR)</div><div class="line">          android.util.Log.e(tag, msg);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">d</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (logLevel &lt;= Log.DEBUG)</div><div class="line">          android.util.Log.d(tag, msg);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">v</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (logLevel &lt;= Log.VERBOSE)</div><div class="line">          android.util.Log.v(tag, msg);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">w</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (logLevel &lt;= Log.WARN)</div><div class="line">          android.util.Log.w(tag, msg);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用Proguard移除代码中的Log代码"><a href="#使用Proguard移除代码中的Log代码" class="headerlink" title="使用Proguard移除代码中的Log代码"></a>使用Proguard移除代码中的Log代码</h3><p>修改Proguard的配置文件，添加以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">-assumenosideeffects class android.util.Log &#123;</div><div class="line"></div><div class="line">public static int v(...);</div><div class="line"></div><div class="line">public static int i(...);</div><div class="line"></div><div class="line">public static int w(...);</div><div class="line"></div><div class="line">public static int d(...);</div><div class="line"></div><div class="line">public static int e(...);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以根据需要在发布时候显示的级别来决定移除哪些级别的Log(需要移除的就放到配置中)，同时Proguard的配置中还要注意不要有<code>-dontoptimize</code>这个配置。</p>
<h3 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h3><p>以上两种方法都可以达到开发阶段不显示Log，正式发布移除Log。但是使用Proguard的方式，可能不是所有程序都会进行Proguard的。这个呢，大家根据自己的项目需求，来选择合适的方法。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2014/08/01/android-push/" class="prev">上一篇</a><a href="/2014/06/28/install-android-in-ubuntu/" class="next">下一篇</a></div><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script><script>var cloudTieConfig = {
    url: document.location.href,
    sourceId: "2014/06/30/remove-log-in-android/",
    productKey: "a094f65b0cf3436d922737584f8a4bb2",
    target: "cloud-tie-wrapper"
};
var yunManualLoad = true;
Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);</script><div class="copyright"><p>© 2013 - 2017 <a href="http://blog.isming.me">Sam</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//hm.baidu.com/h.js?c22f102f5fbaa79cf43b93add1805f4f"></script></body></html>